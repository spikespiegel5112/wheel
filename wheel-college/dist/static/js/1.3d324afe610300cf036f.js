webpackJsonp([1],{"379A":function(e,t,i){e.exports=i.p+"static/img/prize.84b2141.png"},"9GE0":function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__=__webpack_require__("ZLEe"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof__=__webpack_require__("hRKE"),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof__),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign__=__webpack_require__("aA9S"),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign__),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_promise__=__webpack_require__("rVsN"),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_promise___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_promise__),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_json_stringify__=__webpack_require__("3cXf"),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_5_js_cookie__=__webpack_require__("uAC3"),__WEBPACK_IMPORTED_MODULE_5_js_cookie___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_js_cookie__),_unused_webpack_default_export={name:"Wheel",data:function(){return{getUserInfoByTokenRequest:"uaa/user",oauthTokenRequest:"uaa/oauth/token",getActivityInfoRequest:"promotion-service/1.0.0/rotary_table_activity/getActivityInfo",participate_activityRequest:"promotion-service/1.0.0/rotary_table_activity/participate_activity",verificationCodeRequest:"message-service/1.0.0/sms/verificationCode",queryRewardTraceRequest:"promotion-service/1.0.0/rotary_table_activity/queryRewardTrace",queryRewardTraceByLoginIdRequest:"promotion-service/1.0.0/rotary_table_activity/queryRewardTraceByLoginIdRequest",getSignatureRequest:"account-service/1.0.0/weChat/getSignature",participate_accept_rewardRequest:"promotion-service/1.0.0/rotary_table_activity/participate_accept_reward",accessToken:"",statisticImageUrl:"",redirectingFlag:!1,initializing:!1,loading:!1,smsCodeState:!1,jsCookieInstance:__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a,redirectInfo:"",downloadUrl:"",colorDictionary:["#feebcd","#ffb54c"],textColorDictionary:["#C21515","#feebcd"],dotsColorDictionary:["#ffd800","#fe9166"],prizeTypeDictionary:[{name:"趣豆",code:"coin",unit:""},{name:"积分",code:"point",unit:""},{name:"百视通会员卡",code:"bes_tv",unit:""},{name:"third_link",code:"third_link",unit:""}],wheelData:[{name:"比萨饼",value:10,image:"https://pic5.40017.cn/01/000/79/0a/rBLkBVpVuxmAUQqmAAARnUFXcFc487.png"},{name:"酱肘子",value:20,image:"http://upload.wikimedia.org/wikipedia/commons/thumb/4/47/PNG_transparency_demonstration_1.png/280px-PNG_transparency_demonstration_1.png"},{name:"红烧肉",value:30,image:"http://pic.c-ctrip.com/platform/online/home/un_index_supply.png"},{name:"炖排骨",value:30,image:"http://resource.zan-qian.com/test/icon/1534327599157.jpeg-style_100x100"},{name:"小鸡炖蘑菇",value:30,image:"http://resource.zan-qian.com/test/icon/1534327599157.jpeg-style_100x100"},{name:"牛排",value:30,image:"http://resource.zan-qian.com/test/icon/1534327599157.jpeg-style_100x100"}],sponsor:[{name:""}],activityInfo:{},wheelCanvas:{},remUnit:0,canvasWidth:"400px",canvasHeight:"400px",canvasReadyFlag:!1,rotatingFlag:!1,verificationCode:"",rotateDuration:3e3,dialogFlag:!1,phoneNumber:"",phoneNumberReceiveFlag:!1,tokenReceiveFlag:!1,loginToGetPrizeListFlag:!1,smsCodeCountDown:0,smsCodeCountDownDuration:60,rewardRecordList:[],productToken:"",prizeData:{},alreadyReleasedPrize:!1,alreadyReceivedPrize:!1,rewardCode:"",actualRotate:0,dailyLimit:"",pageFingerPrint:"",environment:"",stateCodeData:{},openId:"",loginId:"",userInfo:{},environmentDictionary:[{name:"ios",method:"window.webkit.messageHandlers.token.postMessage('')",checker:"window.webkit",status:!1},{name:"android",method:"window.android.getToken()",checker:"window.android",status:!1},{name:"wechat",checker:"console",status:!1}]}},computed:{activityId:function(){return this.$route.query.activityId||3},channel:function(){return this.$route.query.channel||""},userActivityId:function(){return this.$route.query.state},identityCode:function(){return this.$route.query.state},wechatAuthCode:function(){return console.log(this.$route),this.$route.query.code},stateCode:function(){return this.$route.query.state}},watch:{remUnit:function(e){var t=this;this.$nextTick(function(){t.canvasWidth=13.5*e+"px",t.canvasHeight=13.5*e+"px",t.getPrizeList()})},weChatAuthorityURL:function(e){console.log(e)},initializing:function(e){},alreadyReleasedPrize:function(e){this.$nextTick(function(){sessionStorage.setItem("alreadyReleasedPrize",e)})},alreadyReceivedPrize:function(e){this.$nextTick(function(){sessionStorage.setItem("alreadyReceivedPrize",e)})},rewardCode:function(e){sessionStorage.setItem("rewardCode",e)},rewardStr:function(e){sessionStorage.setItem("rewardStr",e)},prizeData:function(e){console.log("prizeData",e),sessionStorage.removeItem("prizeData"),sessionStorage.setItem("prizeData",__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_json_stringify___default()(e))},dailyLimit:function(e){sessionStorage.setItem("dailyLimit",e)}},created:function(){this.redirectInfo=this.$route.query.routeto},beforeMount:function(){window.location.href},mounted:function(){var e=this;this.initializing=!1,this.$nextTick(function(){e.$autoHeight({target:".wheel_winningdialog_wrapper"}),e.$remResizing({fontSize:20})}),this.$nextTick(function(){e.remUnit=Number(document.getElementsByTagName("html")[0].style.fontSize.replace("px",""))}),this.getCacheData(),"wechat"===this.checkUserAgent()&&this.processStateCode(),this.checkEnvironment(),this.alreadyReceivedPrize||"wechat"!==this.checkEnvironment()?this.$nextTick(function(){if("wechat"!==e.checkEnvironment()){switch(e.checkEnvironment()){case"android":e.accessToken=window.android.getToken();break;case"ios":e.accessToken=window.webkit.messageHandlers.token.postMessage("")}alert("this.accessToken+"+e.accessToken),alert("method+"+e.checkEnvironment())}}):(alert(this.wechatAuthCode),this.getWechatToken({type:"wechat_code",params:{code:this.wechatAuthCode}})),this.checkUUID(),this.getRewardRecordList(),this.getStatisticImageUrl(),this.recordStatisticEvent("onLoad"),this.initJSSDK()},methods:{processStateCode:function(){var e=[],t=decodeURIComponent(this.stateCode);t.split("^").forEach(function(t){e[t.split("=")[0]]=t.split("=")[1]}),this.stateCodeData=e,this.channel=e.channel,this.activityId=e.activityId,console.log(e),console.log(t)},getWechatToken:function(e){var t=this;return new __WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_promise___default.a(function(i,a){e=__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign___default()({type:"",params:{}},e);"wechat"===t.checkEnvironment()?t.$http.post(t.$baseUrl+t.oauthTokenRequest,__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign___default()({grant_type:e.type},e.params),{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic YW5kcm9pZDphZG1pbg=="},transformRequest:[function(e){var t="";for(var i in e)t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i])+"&";return t}]}).then(function(e){console.log("oauthTokenRequest",e),t.accessToken=e.access_token,__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.set("wheel-accessToken",e.access_token),i(e)}).catch(function(e){switch(console.log("error",e),e.data.code){case 1:case 2:t.dialogFlag=!0,t.loginToGetPrizeListFlag=!0,t.openId=e.data.openId,t.cleanCache(),a(e);break;case 3:t.cleanCache(),a(e)}}):alert("当前不是微信环境")})},reinitializePage:function(){var e="channel="+this.loginId+"^activityId="+this.activityId;location.assign("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx67c26ff8068af257&redirect_uri="+this.$domainUrl+"&response_type=code&scope=snsapi_userinfo&state="+e+"#wechat_redirect")},getLoginId:function(){var e=this;this.$http.get(this.$baseUrl+this.getUserInfoByTokenRequest,{params:{access_token:this.accessToken},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){console.log(t),e.loginId=t.name,__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.set("wheel-loginId",e.loginId)}).catch(function(e){console.log(e)})},getPrizeList:function(){var e=this;this.loading=!0,this.$http.get(this.$baseUrl+this.getActivityInfoRequest,{params:{activityId:3}}).then(function(t){console.log(t),e.loading=!1,t=t.data,e.wheelData=[],e.activityInfo=t.activityInfo,JSON.parse("null"===sessionStorage.getItem("dailyLimit"))&&(e.dailyLimit=t.activityInfo.dailyLimit),t.rewardList.forEach(function(t,i){e.wheelData.push({name:t.rewardName,image:null!==t.rewardImage?t.rewardImage+"-style_100x100":"",value:t.rewardStr})}),e.drawCanvas(),e.getCachedCircleNumber()}).catch(function(t){console.log(t),e.loading=!1,e.$vux.confirm.show({showCancelButton:!1,title:t.data.message,onConfirm:function(){}})})},drawPrize:function(){var e=this;this.loading=!0,this.$http.post(this.$baseUrl+this.participate_activityRequest,{},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){console.log(t),e.loading=!1;var i=t;switch(t=t.data,i.code){case 1e4:e.prizeData=t,e.rewardCode=t.rewardCode,e.wheelData.forEach(function(i,a){i.value===t.rewardStr&&e.rotateWheel(a).then(function(){e.alreadyReceivedPrize=!1,e.alreadyReleasedPrize=!0,e.dailyLimit=Number(e.dailyLimit)>0?Number(e.dailyLimit)-1:e.dailyLimit,e.rewardStr=t.rewardStr,e.$store.commit("turnOffWinningPrizeChance")})});break;case 10004:e.$vux.confirm.show({showCancelButton:!1,title:i.message,onConfirm:function(){}})}})},receivePrize:function(){this.loading=!1,this.recordStatisticEvent("receivePrize"),alert(__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-accessToken")),void 0!==__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-accessToken")?(this.dialogFlag=!0,this.tokenReceiveFlag=!0):void 0!==__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-accessToken")&&void 0!==__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-loginId")||(this.dialogFlag=!0,this.tokenReceiveFlag=!1)},drawAndReceivePrize:function(){alert("drawAndReceivePrize");""===this.accessToken?(this.dialogFlag=!0,this.loginToGetPrizeListFlag=!0):this.receivePrizeByToken()},getCachedCircleNumber:function(){if(void 0!==sessionStorage.getItem("actualRotate")&&0!==sessionStorage.getItem("actualRotate")){this.actualRotate=sessionStorage.getItem("actualRotate");var e=this.actualRotate%360;this.wheelCanvas.style.transform="rotate("+e+"deg)"}},rotateWheel:function(e){var t=this;return new __WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_promise___default.a(function(i,a){console.log(111,e),e=t.wheelData.length-e;var o=360/t.wheelData.length;console.log(222,3600+o*e),t.actualRotate=3600+o*e,t.wheelCanvas.style.transform="rotate(-"+t.actualRotate+"deg)",sessionStorage.setItem("actualRotate",t.actualRotate),t.rotatingFlag?a():(t.rotatingFlag=!0,t.wheelCanvas.style.transition="all "+t.rotateDuration/1e3+"s ease",t.wheelCanvas.style.transform="rotate("+t.actualRotate+"deg)",setTimeout(function(){t.rotatingFlag=!1,t.wheelCanvas.style.transition="rotate 0s ease",i()},t.rotateDuration))})},receivePrizeByForm:function(){var e=this;return this.phoneNumber=this.phoneNumber.replace(/(^\s*)|(\s*$)/g,""),this.verificationCode=this.verificationCode.replace(/(^\s*)|(\s*$)/g,""),""===this.phoneNumber?void this.$vux.confirm.show({showCancelButton:!1,title:"手机号未填写",onConfirm:function(){}}):!1===/^[1-9]+[0-9]*]*$/.test(this.phoneNumber)?void this.$vux.confirm.show({showCancelButton:!1,title:"手机号不是数字",onConfirm:function(){}}):!1===/^[1-9]+[0-9]*]*$/.test(this.verificationCode)?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码不是数字",onConfirm:function(){}}):!1===/^\d{6}$/.test(this.verificationCode)?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码不为6位数字",onConfirm:function(){}}):""===this.verificationCode?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码未填写",onConfirm:function(){}}):void this.getWechatToken({type:"sms",params:{username:this.phoneNumber,code:this.verificationCode,source:"zhinengxiaoyuan",promotionCode:"",openId:this.openId,channel:this.channel,activityId:this.activityId}}).then(function(t){e.dialogFlag=!1,e.loginToGetPrizeListFlag=!1,sessionStorage.setItem("userInfo",__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_json_stringify___default()(t)),e.receivePrizeByToken()})},receivePrizeByToken:function(){var e=this,t=this;this.alreadyReceivedPrize?this.$router.push({name:"acceptPrize",query:{rewardStr:this.prizeData.rewardStr}}):this.$http.post(this.$baseUrl+this.participate_accept_rewardRequest+"/"+this.activityId,{},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer "+this.accessToken}}).then(function(t){console.log("participate_accept_rewardRequest",t);var i=t;switch(t=t.data,i.code){case 1e4:console.log("10000",e.wheelData),e.rewardCode=t.rewardCode,e.wheelData.forEach(function(i,a){i.value===t.rewardStr&&e.rotateWheel(a).then(function(){e.alreadyReceivedPrize=!0,e.alreadyReleasedPrize=!0,e.dailyLimit=Number(e.dailyLimit)>0?Number(e.dailyLimit)-1:e.dailyLimit,e.rewardStr=t.rewardStr,e.prizeData=__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign___default()(t,{rewardName:i.name}),e.$store.commit("turnOffWinningPrizeChance"),e.receivePrize()})});break;case 10002:case 10004:e.$vux.confirm.show({showCancelButton:!1,title:i.message,onConfirm:function(){}})}}).catch(function(i){console.log(i),401===i.status&&e.$vux.confirm.show({showCancelButton:!1,title:"当前登录信息已失效",onConfirm:function(){t.tokenReceiveFlag=!1}})})},drawCanvas:function(){var e=this;console.log(this.remUnit),this.wheelCanvas=document.getElementById("wheelcanvas");var t=this.wheelCanvas.getContext("2d"),i=this.wheelCanvas.getContext("2d"),a=2*Math.PI/this.wheelData.length,o=13.5*this.remUnit,n=13.5*this.remUnit;t.font=this.remUnit,i.beginPath(),i.arc(o/2,n/2,6.75*this.remUnit,0,2*Math.PI,!0),i.fillStyle="rgba(188,75,61,0.5)",i.fill(),i.beginPath(),i.arc(o/2,n/2,6.57*this.remUnit,0,2*Math.PI,!0),i.fillStyle="#bc4b3d",i.fill(),i.beginPath(),i.arc(o/2,n/2,6.35*this.remUnit,0,2*Math.PI,!0),i.fillStyle="#f06949",i.fill(),i.save();var s=function(){for(var i=0;i<24;i++){t.beginPath();var a=2*Math.PI/24*i,s=.5*o+Math.cos(a)*e.remUnit*5.9,r=.5*n+Math.sin(a)*e.remUnit*5.9;t.arc(s,r,.35*e.remUnit,e.remUnit,2*Math.PI,!0),t.fillStyle=i%2==0?e.dotsColorDictionary[0]:e.dotsColorDictionary[1],t.fill()}};s(),setInterval(function(){s(),e.dotsColorDictionary=e.dotsColorDictionary.reverse()},1e3);var r=[];this.wheelData.forEach(function(t,i){var a=new Image;a.width="150",a.height="150",a.src=e.$replaceProtocol(e.wheelData[i].image),a.transparency=.2,r.push(a)}),this.wheelData.forEach(function(i,s){var c=a*s;e.checkLowestCommonDivisorWith2(e.wheelData.length)?c-=Math.PI:c=c-Math.PI+a,t.beginPath(),t.moveTo(o/2,n/2),t.lineWidth=3,e.checkLowestCommonDivisorWith2(e.wheelData.length)?t.arc(o/2,n/2,5.4*e.remUnit,c+a-Math.PI/e.wheelData.length,c-Math.PI/e.wheelData.length,!0):t.arc(o/2,n/2,5.4*e.remUnit,c+a,c,!0),t.lineTo(o/2,n/2),t.strokeStyle="#f06949",t.stroke(),t.fillStyle=e.colorDictionary[s%2],t.save(),t.fill(),r[s].onload=function(){var i=void 0,_=void 0;e.checkLowestCommonDivisorWith2(e.wheelData.length)?(i=.5*o+Math.cos(c+a/2-Math.PI/2-Math.PI/e.wheelData.length)*e.remUnit*5,_=.5*n+Math.sin(c+a/2-Math.PI/2-Math.PI/e.wheelData.length)*e.remUnit*5):(i=.5*o+Math.cos(c+a/2)*e.remUnit*5,_=.5*n+Math.sin(c+a/2)*e.remUnit*5),t.font=.5*e.remUnit+"px Georgia",t.fillStyle=e.textColorDictionary[s%2],t.translate(i,_),t.rotate(c+Math.PI/2+a/2),t.fillText(e.wheelData[s].name,-t.measureText(e.wheelData[s].name).width/2,22),t.drawImage(r[s],2*-e.remUnit*.5,1.3*e.remUnit,2*e.remUnit,2*e.remUnit),t.shadowColor="#000",t.shadowBlur=10,t.shadowOffsetX=0,t.shadowOffsetY=0,t.restore(),t.save()},t.restore(),t.save()}),this.getCachedCircleNumber()},sendSmsCode:function(){var e=this;if(""===this.phoneNumber)return void this.$vux.confirm.show({showCancelButton:!1,title:"请输入手机号",onConfirm:function(){}});!1===this.smsCodeState?(this.loading=!0,this.$http.get(this.$baseUrl+this.verificationCodeRequest+"/"+this.phoneNumber+"/1").then(function(t){console.log(t),e.loading=!1,!0===t.alreadySent?(e.$vux.confirm.show({showCancelButton:!1,title:"短信已发出，请查收",onConfirm:function(){}}),e.smsCodeState=!0,e.smsCodeCountDown=e.smsCodeCountDownDuration,e.smsCodeCountDown>0?setInterval(function(){0===--e.smsCodeCountDown&&(e.smsCodeState=!1,e.smsCodeCountDown=60)},1e3):e.smsCodeState=!1):e.$vux.confirm.show({showCancelButton:!1,title:t.message,onConfirm:function(){}})}).catch(function(t){console.log(t),e.$vux.confirm.show({showCancelButton:!1,title:"短信已发出，请稍后再试",onConfirm:function(){}}),e.loading=!1})):this.$vux.confirm.show({showCancelButton:!1,title:"短信已发出，请稍后再试",onConfirm:function(){}})},checkLowestCommonDivisorWith2:function(e){for(var t=!0,i=2;i<e;i++)2!==(e/=2)&&(t=e%2==0);return t},changeUser:function(){this.phoneNumber="",this.verificationCode="",this.tokenReceiveFlag=!1,__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.remove("")},getRewardRecordList:function(){var e=this;this.$http.get(this.$baseUrl+this.queryRewardTraceRequest,{params:{activityId:""}}).then(function(t){console.log("getRewardRecordList",t),t=t.data,e.rewardRecordList=t})},close:function(){this.dialogFlag=!1,this.tokenReceiveFlag=!1,this.loginToGetPrizeListFlag=!1},checkAuthorized:function(){return"undefined"===__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-accessToken")||void 0===__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-accessToken")},loginToCheckMyPrize:function(){this.checkAuthorized()?(this.dialogFlag=!0,this.loginToGetPrizeListFlag=!0):this.$router.push({name:"myPrizeList",query:{loginId:__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-loginId"),pageNo:0}})},login:function(){var e=this;return this.phoneNumber=this.phoneNumber.replace(/(^\s*)|(\s*$)/g,""),this.verificationCode=this.verificationCode.replace(/(^\s*)|(\s*$)/g,""),""===this.phoneNumber?void this.$vux.confirm.show({showCancelButton:!1,title:"手机号未填写",onConfirm:function(){}}):!1===/^[1-9]+[0-9]*]*$/.test(this.phoneNumber)?void this.$vux.confirm.show({showCancelButton:!1,title:"手机号不是数字",onConfirm:function(){}}):!1===/^[1-9]+[0-9]*]*$/.test(this.verificationCode)?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码不是数字",onConfirm:function(){}}):!1===/^\d{6}$/.test(this.verificationCode)?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码不为6位数字",onConfirm:function(){}}):""===this.verificationCode?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码未填写",onConfirm:function(){}}):void this.getWechatToken({type:"sms",params:{username:this.phoneNumber,code:this.verificationCode,source:"zhinengxiaoyuan",promotionCode:"",openId:this.openId,channel:this.channel,activityId:this.activityId}}).then(function(t){e.$http.post(e.$baseUrl+e.oauthTokenRequest,{grant_type:"sms",username:e.phoneNumber,code:e.verificationCode},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic YW5kcm9pZDphZG1pbg=="},transformRequest:[function(e){var t="";for(var i in e)t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i])+"&";return t}]}).then(function(t){console.log(t),__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.set("wheel-accessToken",t.access_token),__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.set("wheel-loginId",e.phoneNumber),e.$router.push({name:"myPrizeList",query:{loginId:__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-loginId"),pageNo:0,token:t.access_token}})}).catch(function(t){e.$vux.confirm.show({showCancelButton:!1,title:t.data.error_description||t.data.message,onConfirm:function(){}})})})},getCacheData:function getCacheData(){var regex=new RegExp(/(true)|(false)/);console.log(regex.test(sessionStorage.getItem("alreadyReleasedPrize"))),regex.test(sessionStorage.getItem("alreadyReleasedPrize"))&&(this.alreadyReleasedPrize=eval(sessionStorage.getItem("alreadyReleasedPrize")),this.rewardCode=sessionStorage.getItem("rewardCode"),this.rewardStr=sessionStorage.getItem("rewardStr"),this.prizeData=JSON.parse(sessionStorage.getItem("prizeData"))),regex.test(sessionStorage.getItem("alreadyReceivedPrize"))&&(this.alreadyReceivedPrize=eval(sessionStorage.getItem("alreadyReceivedPrize"))),"number"==typeof Number(sessionStorage.getItem("dailyLimit"))&&(this.dailyLimit=sessionStorage.getItem("dailyLimit")),"object"===__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof___default()(JSON.parse(sessionStorage.getItem("prizeData")))?this.alreadyReleasedPrize=eval(sessionStorage.getItem("alreadyReleasedPrize")):(console.log(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(JSON.parse(sessionStorage.getItem("prizeData"))).length>0),this.cleanCache()),"object"===__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof___default()(JSON.parse(sessionStorage.getItem("userInfo")))&&(this.userInfo=JSON.parse(sessionStorage.getItem("userInfo")))},cleanCache:function(){this.alreadyReleasedPrize=!1,this.alreadyReceivedPrize=!1,this.dialogFlag=!1,this.phoneNumberReceiveFlag=!1,this.tokenReceiveFlag=!1,setTimeout(function(){sessionStorage.removeItem("alreadyReleasedPrize"),sessionStorage.removeItem("alreadyReceivedPrize"),sessionStorage.removeItem("rewardCode"),sessionStorage.removeItem("rewardStr"),sessionStorage.removeItem("prizeData"),sessionStorage.removeItem("actualRotate"),sessionStorage.removeItem("dailyLimit"),sessionStorage.removeItem("userInfo")},500)},getStatisticImageUrl:function(){this.statisticImageUrl=this.$baseUrl+"message-service/1.0.0/statistics.jpg?source=tongcheng&timeStamp="+Date.parse(new Date)},recordStatisticEvent:function(e){var t=document.createElement("img");t.className="statistic",t.src=this.$baseUrl+"message-service/1.0.0/statistics.jpg?source=tongcheng&timeStamp="+Date.parse(new Date)+"&eventId="+e+"&webId="+this.pageFingerPrint,t.width=0,t.height=0,document.querySelector(".wheel_realpage_container").appendChild(t)},checkUUID:function(){__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-pageFingerPrint")?this.pageFingerPrint=__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-pageFingerPrint"):(this.pageFingerPrint=this.$generateUUID(),__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.set("wheel-pageFingerPrint",this.pageFingerPrint))},initJSSDK:function(){var e=this;console.log("777",location.href.split("#")[0]);var t=this.$wechat;this.$http.post(this.$baseUrl+this.getSignatureRequest,{url:location.href.split("#")[0]},{headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){var t="";for(var i in e)t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i])+"&";return t}]}).then(function(i){console.log(i),t.config({debug:!1,appId:"wx67c26ff8068af257",timestamp:i.data.timestamp,nonceStr:i.data.nonceStr,signature:i.data.signature,jsApiList:["closeWindow","chooseWXPay","onMenuShareAppMessage","onMenuShareTimeline","hideMenuItems"]}),t.error(function(e){console.log(e),alert("error")}),t.ready(function(i){console.log(i),t.checkJsApi({jsApiList:["onMenuShareAppMessage","onMenuShareTimeline"],success:function(e){}}),t.onMenuShareTimeline({title:"免费畅享全年NBA直播的机会在这里",link:e.$domainUrl+"/?routeto=shareredirect&state="+e.stateCode,imgUrl:"http://resource.zan-qian.com/share/red_packet20180727191755.png-style_108x144",success:function(){}}),t.onMenuShareAppMessage({title:"免费畅享全年NBA直播的机会在这里",desc:"千万不要错过哦",link:e.$domainUrl+"/?routeto=shareredirect&state="+e.stateCode,imgUrl:"http://resource.zan-qian.com/share/red_packet20180727191755.png-style_108x144",type:"",dataUrl:"",success:function(){}})})})},checkUserAgent:function(){var e=navigator.userAgent,t=void 0,i=e.indexOf("Android")>-1||e.indexOf("Adr")>-1,a=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),o="micromessenger"===!!e.match(/MicroMessenger/i);return i?(t="android",alert("Android")):a?(t="ios",alert("iOS")):o?(alert("wechat"),t="wechat"):(alert("web"),t="web"),this.environment=t,t},checkEnvironment:function checkEnvironment(){var environment=void 0;switch(environment=this.environmentDictionary.filter(function(item){return void 0!==eval(item.checker)})[0].name){case"ios":case"android":case"wechat":console.warn(environment),alert("environment+"+environment)}return this.environment=environment,environment}}}},"F/ER":function(e,t,i){"use strict";function a(e){_||i("Trrl")}Object.defineProperty(t,"__esModule",{value:!0});var o=(i("9GE0"),i("PbNv")),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"common_main_container"},[i("div",{staticClass:"content",attrs:{id:"app"}},[i("div",{staticClass:"bg"}),e._v(" "),i("div",{staticClass:"wheel_realpage_container"},[i("div",{staticClass:"header"},[i("div",{staticClass:"nav"},[i("div",{staticClass:"left"},[i("router-link",{staticClass:"a",attrs:{to:{name:"activityRules"}}},[e._v("\n                活动规则\n              ")])],1),e._v(" "),i("div",{staticClass:"right"},[i("a",{staticClass:"a",on:{click:e.loginToCheckMyPrize}},[e._v("\n                我的奖品\n              ")])])]),e._v(" "),e._m(0)]),e._v(" "),i("div",{staticClass:"wheel_wrapper"},[i("div",{staticClass:"wheel"},[i("canvas",{attrs:{id:"wheelcanvas",width:13.5*e.remUnit,height:13.5*e.remUnit}},[e._v("抱歉！浏览器不支持。")]),e._v(" "),e.alreadyReleasedPrize||e.alreadyReceivedPrize?i("a",{staticClass:"continue",on:{click:e.receivePrize}}):i("a",{staticClass:"begin",on:{click:e.drawAndReceivePrize}})]),e._v(" "),e._m(1)]),e._v(" "),e._m(2),e._v(" "),i("div",{staticClass:"winninglist"},[i("ul",e._l(e.rewardRecordList,function(t){return i("li",[i("label",[e._v("恭喜"+e._s(t.loginId.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2")))]),e._v(" "),i("span",[e._v('免费获得"'+e._s(t.rewardName)+'"奖品')])])}))])]),e._v(" "),i("CommonLoading",{attrs:{loading:e.loading}})],1)]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.dialogFlag,expression:"dialogFlag"}],staticClass:"wheel_winningdialog_wrapper"},[i("div",{staticClass:"login"},[e.phoneNumberReceiveFlag?i("div",{},[i("div",{staticClass:"crown"}),e._v(" "),i("div",{staticClass:"dialog_wrapper inputphonenumber"},[i("p",{staticClass:"hint"},[e._v('\n            已抽中"'+e._s(e.prizeData.rewardName)+'"'),i("br"),e._v(" "),i("span",[e._v("登录即可免费获得")])]),e._v(" "),i("div",{staticClass:"form"},[i("div",{staticClass:"inputitem"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.phoneNumber,expression:"phoneNumber"}],staticClass:"phone",attrs:{placeholder:"请输入手机号"},domProps:{value:e.phoneNumber},on:{input:function(t){t.target.composing||(e.phoneNumber=t.target.value)}}})]),e._v(" "),i("div",{staticClass:"inputitem"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.verificationCode,expression:"verificationCode"}],staticClass:"smscode",attrs:{placeholder:"验证码"},domProps:{value:e.verificationCode},on:{input:function(t){t.target.composing||(e.verificationCode=t.target.value)}}}),e._v(" "),i("a",{staticClass:"button smscodebutton",class:{disable:e.smsCodeState},on:{click:e.sendSmsCode}},[e._v(e._s(e.smsCodeState?e.smsCodeCountDown+"s":"获取"))])]),e._v(" "),i("a",{staticClass:"button",on:{click:e.receivePrizeByForm}},[e._v("免费领取")])])])]):e._e(),e._v(" "),e.tokenReceiveFlag?i("div",{},[i("div",{staticClass:"crown"}),e._v(" "),i("div",{staticClass:"dialog_wrapper acceptprize"},[i("p",{staticClass:"hint"},[e._v('\n\n            已抽中"'+e._s(e.prizeData.rewardName)+'"\n          ')]),e._v(" "),e._m(3),e._v(" "),i("a",{staticClass:"button",on:{click:e.receivePrizeByToken}},[e._v("免费领取")]),e._v(" "),i("div",{staticClass:"userinfo"},[i("span",[e._v(e._s(e.jsCookieInstance.get("wheel-loginId")))])])])]):e._e(),e._v(" "),e.loginToGetPrizeListFlag?i("div",{},[i("div",{staticClass:"dialog_wrapper inputphonenumber"},[i("p",{staticClass:"hint"},[e._v("\n            登 录\n          ")]),e._v(" "),i("div",{staticClass:"form"},[i("div",{staticClass:"inputitem"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.phoneNumber,expression:"phoneNumber"}],staticClass:"phone",attrs:{placeholder:"请输入手机号"},domProps:{value:e.phoneNumber},on:{input:function(t){t.target.composing||(e.phoneNumber=t.target.value)}}})]),e._v(" "),i("div",{staticClass:"inputitem"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.verificationCode,expression:"verificationCode"}],staticClass:"smscode",attrs:{placeholder:"验证码"},domProps:{value:e.verificationCode},on:{input:function(t){t.target.composing||(e.verificationCode=t.target.value)}}}),e._v(" "),i("a",{staticClass:"button smscodebutton",class:{disable:e.smsCodeState},on:{click:e.sendSmsCode}},[e._v(e._s(e.smsCodeState?e.smsCodeCountDown+"s":"获取"))])]),e._v(" "),i("a",{staticClass:"button",on:{click:e.receivePrizeByForm}},[e._v("确定")])])])]):e._e(),e._v(" "),i("div",{staticClass:"close"},[i("a",{on:{click:e.close}})])])])])},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"chance"},[i("div",{staticClass:"decoration"},[i("span",{staticClass:"left"},[i("i"),e._v(" "),i("label")]),e._v(" "),i("span",{staticClass:"right"},[i("label"),e._v(" "),i("i")])]),e._v(" "),i("p",[e._v("\n              您有"),i("span",[e._v("33")]),e._v("次领奖机会\n            ")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"prizechance"},[i("h1",[e._v("点击右上角“"),i("span",[e._v("分享")]),e._v("”可以额外获得领奖机会")]),e._v(" "),i("label",[e._v("每邀请一位用户参与抽奖，获得一次抽奖机会")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"common_blocktitle_item"},[i("div",[i("span"),e._v(" "),i("i")]),e._v(" "),i("p",[e._v("中奖名单")]),e._v(" "),i("div",[i("i"),e._v(" "),i("span")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"banner"},[a("img",{attrs:{src:i("379A")}})])}];n._withStripped=!0;var r={render:n,staticRenderFns:s},c=r,_=!1,l=i("C7Lr"),h=a,d=l(o.a,c,!1,h,"data-v-c14efc4a",null);d.options.__file="src/components/Wheel.vue";t.default=d.exports},"MA3+":function(e,t,i){t=e.exports=i("UTlt")(!1),t.push([e.i,"/*.chance{*/\n/*font-size: 0;*/\n/*}*/\n",""])},PbNv:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__=__webpack_require__("ZLEe"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof__=__webpack_require__("hRKE"),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof__),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign__=__webpack_require__("aA9S"),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign__),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_promise__=__webpack_require__("rVsN"),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_promise___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_promise__),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_json_stringify__=__webpack_require__("3cXf"),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_5_js_cookie__=__webpack_require__("uAC3"),__WEBPACK_IMPORTED_MODULE_5_js_cookie___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_js_cookie__);__webpack_exports__.a={name:"Wheel",data:function(){return{getUserInfoByTokenRequest:"uaa/user",oauthTokenRequest:"uaa/oauth/token",getActivityInfoRequest:"promotion-service/1.0.0/rotary_table_activity/getActivityInfo",participate_activityRequest:"promotion-service/1.0.0/rotary_table_activity/participate_activity",verificationCodeRequest:"message-service/1.0.0/sms/verificationCode",queryRewardTraceRequest:"promotion-service/1.0.0/rotary_table_activity/queryRewardTrace",queryRewardTraceByLoginIdRequest:"promotion-service/1.0.0/rotary_table_activity/queryRewardTraceByLoginIdRequest",getSignatureRequest:"account-service/1.0.0/weChat/getSignature",participate_accept_rewardRequest:"promotion-service/1.0.0/rotary_table_activity/participate_accept_reward",accessToken:"",statisticImageUrl:"",redirectingFlag:!1,initializing:!1,loading:!1,smsCodeState:!1,jsCookieInstance:__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a,redirectInfo:"",downloadUrl:"",colorDictionary:["#feebcd","#ffb54c"],textColorDictionary:["#C21515","#feebcd"],dotsColorDictionary:["#ffd800","#fe9166"],prizeTypeDictionary:[{name:"趣豆",code:"coin",unit:""},{name:"积分",code:"point",unit:""},{name:"百视通会员卡",code:"bes_tv",unit:""},{name:"third_link",code:"third_link",unit:""}],wheelData:[{name:"比萨饼",value:10,image:"https://pic5.40017.cn/01/000/79/0a/rBLkBVpVuxmAUQqmAAARnUFXcFc487.png"},{name:"酱肘子",value:20,image:"http://upload.wikimedia.org/wikipedia/commons/thumb/4/47/PNG_transparency_demonstration_1.png/280px-PNG_transparency_demonstration_1.png"},{name:"红烧肉",value:30,image:"http://pic.c-ctrip.com/platform/online/home/un_index_supply.png"},{name:"炖排骨",value:30,image:"http://resource.zan-qian.com/test/icon/1534327599157.jpeg-style_100x100"},{name:"小鸡炖蘑菇",value:30,image:"http://resource.zan-qian.com/test/icon/1534327599157.jpeg-style_100x100"},{name:"牛排",value:30,image:"http://resource.zan-qian.com/test/icon/1534327599157.jpeg-style_100x100"}],sponsor:[{name:""}],activityInfo:{},wheelCanvas:{},remUnit:0,canvasWidth:"400px",canvasHeight:"400px",canvasReadyFlag:!1,rotatingFlag:!1,verificationCode:"",rotateDuration:3e3,dialogFlag:!1,phoneNumber:"",phoneNumberReceiveFlag:!1,tokenReceiveFlag:!1,loginToGetPrizeListFlag:!1,smsCodeCountDown:0,smsCodeCountDownDuration:60,rewardRecordList:[],productToken:"",prizeData:{},alreadyReleasedPrize:!1,alreadyReceivedPrize:!1,rewardCode:"",actualRotate:0,dailyLimit:"",pageFingerPrint:"",environment:"",stateCodeData:{},openId:"",loginId:"",userInfo:{},environmentDictionary:[{name:"ios",method:"window.webkit.messageHandlers.token.postMessage('')",checker:"window.webkit",status:!1},{name:"android",method:"window.android.getToken()",checker:"window.android",status:!1},{name:"wechat",checker:"console",status:!1}]}},computed:{activityId:function(){return this.$route.query.activityId||3},channel:function(){return this.$route.query.channel||""},userActivityId:function(){return this.$route.query.state},identityCode:function(){return this.$route.query.state},wechatAuthCode:function(){return console.log(this.$route),this.$route.query.code},stateCode:function(){return this.$route.query.state}},watch:{remUnit:function(e){var t=this;this.$nextTick(function(){t.canvasWidth=13.5*e+"px",t.canvasHeight=13.5*e+"px",t.getPrizeList()})},weChatAuthorityURL:function(e){console.log(e)},initializing:function(e){},alreadyReleasedPrize:function(e){this.$nextTick(function(){sessionStorage.setItem("alreadyReleasedPrize",e)})},alreadyReceivedPrize:function(e){this.$nextTick(function(){sessionStorage.setItem("alreadyReceivedPrize",e)})},rewardCode:function(e){sessionStorage.setItem("rewardCode",e)},rewardStr:function(e){sessionStorage.setItem("rewardStr",e)},prizeData:function(e){console.log("prizeData",e),sessionStorage.removeItem("prizeData"),sessionStorage.setItem("prizeData",__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_json_stringify___default()(e))},dailyLimit:function(e){sessionStorage.setItem("dailyLimit",e)}},created:function(){this.redirectInfo=this.$route.query.routeto},beforeMount:function(){window.location.href},mounted:function(){var e=this;this.initializing=!1,this.$nextTick(function(){e.$autoHeight({target:".wheel_winningdialog_wrapper"}),e.$remResizing({fontSize:20})}),this.$nextTick(function(){e.remUnit=Number(document.getElementsByTagName("html")[0].style.fontSize.replace("px",""))}),this.getCacheData(),"wechat"===this.checkUserAgent()&&this.processStateCode(),this.checkEnvironment(),this.alreadyReceivedPrize||"wechat"!==this.checkEnvironment()?this.$nextTick(function(){if("wechat"!==e.checkEnvironment()){switch(e.checkEnvironment()){case"android":e.accessToken=window.android.getToken();break;case"ios":e.accessToken=window.webkit.messageHandlers.token.postMessage("")}alert("this.accessToken+"+e.accessToken),alert("method+"+e.checkEnvironment())}}):(alert(this.wechatAuthCode),this.getWechatToken({type:"wechat_code",params:{code:this.wechatAuthCode}})),this.checkUUID(),this.getRewardRecordList(),this.getStatisticImageUrl(),this.recordStatisticEvent("onLoad"),this.initJSSDK()},methods:{processStateCode:function(){var e=[],t=decodeURIComponent(this.stateCode);t.split("^").forEach(function(t){e[t.split("=")[0]]=t.split("=")[1]}),this.stateCodeData=e,this.channel=e.channel,this.activityId=e.activityId,console.log(e),console.log(t)},getWechatToken:function(e){var t=this;return new __WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_promise___default.a(function(i,a){e=__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign___default()({type:"",params:{}},e);"wechat"===t.checkEnvironment()?t.$http.post(t.$baseUrl+t.oauthTokenRequest,__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign___default()({grant_type:e.type},e.params),{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic YW5kcm9pZDphZG1pbg=="},transformRequest:[function(e){var t="";for(var i in e)t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i])+"&";return t}]}).then(function(e){console.log("oauthTokenRequest",e),t.accessToken=e.access_token,__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.set("wheel-accessToken",e.access_token),i(e)}).catch(function(e){switch(console.log("error",e),e.data.code){case 1:case 2:t.dialogFlag=!0,t.loginToGetPrizeListFlag=!0,t.openId=e.data.openId,t.cleanCache(),a(e);break;case 3:t.cleanCache(),a(e)}}):alert("当前不是微信环境")})},reinitializePage:function(){var e="channel="+this.loginId+"^activityId="+this.activityId;location.assign("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx67c26ff8068af257&redirect_uri="+this.$domainUrl+"&response_type=code&scope=snsapi_userinfo&state="+e+"#wechat_redirect")},getLoginId:function(){var e=this;this.$http.get(this.$baseUrl+this.getUserInfoByTokenRequest,{params:{access_token:this.accessToken},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){console.log(t),e.loginId=t.name,__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.set("wheel-loginId",e.loginId)}).catch(function(e){console.log(e)})},getPrizeList:function(){var e=this;this.loading=!0,this.$http.get(this.$baseUrl+this.getActivityInfoRequest,{params:{activityId:3}}).then(function(t){console.log(t),e.loading=!1,t=t.data,e.wheelData=[],e.activityInfo=t.activityInfo,JSON.parse("null"===sessionStorage.getItem("dailyLimit"))&&(e.dailyLimit=t.activityInfo.dailyLimit),t.rewardList.forEach(function(t,i){e.wheelData.push({name:t.rewardName,image:null!==t.rewardImage?t.rewardImage+"-style_100x100":"",value:t.rewardStr})}),e.drawCanvas(),e.getCachedCircleNumber()}).catch(function(t){console.log(t),e.loading=!1,e.$vux.confirm.show({showCancelButton:!1,title:t.data.message,onConfirm:function(){}})})},drawPrize:function(){var e=this;this.loading=!0,this.$http.post(this.$baseUrl+this.participate_activityRequest,{},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){console.log(t),e.loading=!1;var i=t;switch(t=t.data,i.code){case 1e4:e.prizeData=t,e.rewardCode=t.rewardCode,e.wheelData.forEach(function(i,a){i.value===t.rewardStr&&e.rotateWheel(a).then(function(){e.alreadyReceivedPrize=!1,e.alreadyReleasedPrize=!0,e.dailyLimit=Number(e.dailyLimit)>0?Number(e.dailyLimit)-1:e.dailyLimit,e.rewardStr=t.rewardStr,e.$store.commit("turnOffWinningPrizeChance")})});break;case 10004:e.$vux.confirm.show({showCancelButton:!1,title:i.message,onConfirm:function(){}})}})},receivePrize:function(){this.loading=!1,this.recordStatisticEvent("receivePrize"),alert(__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-accessToken")),void 0!==__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-accessToken")?(this.dialogFlag=!0,this.tokenReceiveFlag=!0):void 0!==__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-accessToken")&&void 0!==__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-loginId")||(this.dialogFlag=!0,this.tokenReceiveFlag=!1)},drawAndReceivePrize:function(){alert("drawAndReceivePrize");""===this.accessToken?(this.dialogFlag=!0,this.loginToGetPrizeListFlag=!0):this.receivePrizeByToken()},getCachedCircleNumber:function(){if(void 0!==sessionStorage.getItem("actualRotate")&&0!==sessionStorage.getItem("actualRotate")){this.actualRotate=sessionStorage.getItem("actualRotate");var e=this.actualRotate%360;this.wheelCanvas.style.transform="rotate("+e+"deg)"}},rotateWheel:function(e){var t=this;return new __WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_promise___default.a(function(i,a){console.log(111,e),e=t.wheelData.length-e;var o=360/t.wheelData.length;console.log(222,3600+o*e),t.actualRotate=3600+o*e,t.wheelCanvas.style.transform="rotate(-"+t.actualRotate+"deg)",sessionStorage.setItem("actualRotate",t.actualRotate),t.rotatingFlag?a():(t.rotatingFlag=!0,t.wheelCanvas.style.transition="all "+t.rotateDuration/1e3+"s ease",t.wheelCanvas.style.transform="rotate("+t.actualRotate+"deg)",setTimeout(function(){t.rotatingFlag=!1,t.wheelCanvas.style.transition="rotate 0s ease",i()},t.rotateDuration))})},receivePrizeByForm:function(){var e=this;return this.phoneNumber=this.phoneNumber.replace(/(^\s*)|(\s*$)/g,""),this.verificationCode=this.verificationCode.replace(/(^\s*)|(\s*$)/g,""),""===this.phoneNumber?void this.$vux.confirm.show({showCancelButton:!1,title:"手机号未填写",onConfirm:function(){}}):!1===/^[1-9]+[0-9]*]*$/.test(this.phoneNumber)?void this.$vux.confirm.show({showCancelButton:!1,title:"手机号不是数字",onConfirm:function(){}}):!1===/^[1-9]+[0-9]*]*$/.test(this.verificationCode)?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码不是数字",onConfirm:function(){}}):!1===/^\d{6}$/.test(this.verificationCode)?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码不为6位数字",onConfirm:function(){}}):""===this.verificationCode?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码未填写",onConfirm:function(){}}):void this.getWechatToken({type:"sms",params:{username:this.phoneNumber,code:this.verificationCode,source:"zhinengxiaoyuan",promotionCode:"",openId:this.openId,channel:this.channel,activityId:this.activityId}}).then(function(t){e.dialogFlag=!1,e.loginToGetPrizeListFlag=!1,sessionStorage.setItem("userInfo",__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_json_stringify___default()(t)),e.receivePrizeByToken()})},receivePrizeByToken:function(){var e=this,t=this;this.alreadyReceivedPrize?this.$router.push({name:"acceptPrize",query:{rewardStr:this.prizeData.rewardStr}}):this.$http.post(this.$baseUrl+this.participate_accept_rewardRequest+"/"+this.activityId,{},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer "+this.accessToken}}).then(function(t){console.log("participate_accept_rewardRequest",t);var i=t;switch(t=t.data,i.code){case 1e4:console.log("10000",e.wheelData),e.rewardCode=t.rewardCode,e.wheelData.forEach(function(i,a){i.value===t.rewardStr&&e.rotateWheel(a).then(function(){e.alreadyReceivedPrize=!0,e.alreadyReleasedPrize=!0,e.dailyLimit=Number(e.dailyLimit)>0?Number(e.dailyLimit)-1:e.dailyLimit,e.rewardStr=t.rewardStr,e.prizeData=__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign___default()(t,{rewardName:i.name}),e.$store.commit("turnOffWinningPrizeChance"),e.receivePrize()})});break;case 10002:case 10004:e.$vux.confirm.show({showCancelButton:!1,title:i.message,onConfirm:function(){}})}}).catch(function(i){console.log(i),401===i.status&&e.$vux.confirm.show({showCancelButton:!1,title:"当前登录信息已失效",onConfirm:function(){t.tokenReceiveFlag=!1}})})},drawCanvas:function(){var e=this;console.log(this.remUnit),this.wheelCanvas=document.getElementById("wheelcanvas");var t=this.wheelCanvas.getContext("2d"),i=this.wheelCanvas.getContext("2d"),a=2*Math.PI/this.wheelData.length,o=13.5*this.remUnit,n=13.5*this.remUnit;t.font=this.remUnit,i.beginPath(),i.arc(o/2,n/2,6.75*this.remUnit,0,2*Math.PI,!0),i.fillStyle="rgba(188,75,61,0.5)",i.fill(),i.beginPath(),i.arc(o/2,n/2,6.57*this.remUnit,0,2*Math.PI,!0),i.fillStyle="#bc4b3d",i.fill(),i.beginPath(),i.arc(o/2,n/2,6.35*this.remUnit,0,2*Math.PI,!0),i.fillStyle="#f06949",i.fill(),i.save();var s=function(){for(var i=0;i<24;i++){t.beginPath();var a=2*Math.PI/24*i,s=.5*o+Math.cos(a)*e.remUnit*5.9,r=.5*n+Math.sin(a)*e.remUnit*5.9;t.arc(s,r,.35*e.remUnit,e.remUnit,2*Math.PI,!0),t.fillStyle=i%2==0?e.dotsColorDictionary[0]:e.dotsColorDictionary[1],t.fill()}};s(),setInterval(function(){s(),e.dotsColorDictionary=e.dotsColorDictionary.reverse()},1e3);var r=[];this.wheelData.forEach(function(t,i){var a=new Image;a.width="150",a.height="150",a.src=e.$replaceProtocol(e.wheelData[i].image),a.transparency=.2,r.push(a)}),this.wheelData.forEach(function(i,s){var c=a*s;e.checkLowestCommonDivisorWith2(e.wheelData.length)?c-=Math.PI:c=c-Math.PI+a,t.beginPath(),t.moveTo(o/2,n/2),t.lineWidth=3,e.checkLowestCommonDivisorWith2(e.wheelData.length)?t.arc(o/2,n/2,5.4*e.remUnit,c+a-Math.PI/e.wheelData.length,c-Math.PI/e.wheelData.length,!0):t.arc(o/2,n/2,5.4*e.remUnit,c+a,c,!0),t.lineTo(o/2,n/2),t.strokeStyle="#f06949",t.stroke(),t.fillStyle=e.colorDictionary[s%2],t.save(),t.fill(),r[s].onload=function(){var i=void 0,_=void 0;e.checkLowestCommonDivisorWith2(e.wheelData.length)?(i=.5*o+Math.cos(c+a/2-Math.PI/2-Math.PI/e.wheelData.length)*e.remUnit*5,_=.5*n+Math.sin(c+a/2-Math.PI/2-Math.PI/e.wheelData.length)*e.remUnit*5):(i=.5*o+Math.cos(c+a/2)*e.remUnit*5,_=.5*n+Math.sin(c+a/2)*e.remUnit*5),t.font=.5*e.remUnit+"px Georgia",t.fillStyle=e.textColorDictionary[s%2],t.translate(i,_),t.rotate(c+Math.PI/2+a/2),t.fillText(e.wheelData[s].name,-t.measureText(e.wheelData[s].name).width/2,22),t.drawImage(r[s],2*-e.remUnit*.5,1.3*e.remUnit,2*e.remUnit,2*e.remUnit),t.shadowColor="#000",t.shadowBlur=10,t.shadowOffsetX=0,t.shadowOffsetY=0,t.restore(),t.save()},t.restore(),t.save()}),this.getCachedCircleNumber()},sendSmsCode:function(){var e=this;if(""===this.phoneNumber)return void this.$vux.confirm.show({showCancelButton:!1,title:"请输入手机号",onConfirm:function(){}});!1===this.smsCodeState?(this.loading=!0,this.$http.get(this.$baseUrl+this.verificationCodeRequest+"/"+this.phoneNumber+"/1").then(function(t){console.log(t),e.loading=!1,!0===t.alreadySent?(e.$vux.confirm.show({showCancelButton:!1,title:"短信已发出，请查收",onConfirm:function(){}}),e.smsCodeState=!0,e.smsCodeCountDown=e.smsCodeCountDownDuration,e.smsCodeCountDown>0?setInterval(function(){0===--e.smsCodeCountDown&&(e.smsCodeState=!1,e.smsCodeCountDown=60)},1e3):e.smsCodeState=!1):e.$vux.confirm.show({showCancelButton:!1,title:t.message,onConfirm:function(){}})}).catch(function(t){console.log(t),e.$vux.confirm.show({showCancelButton:!1,title:"短信已发出，请稍后再试",onConfirm:function(){}}),e.loading=!1})):this.$vux.confirm.show({showCancelButton:!1,title:"短信已发出，请稍后再试",onConfirm:function(){}})},checkLowestCommonDivisorWith2:function(e){for(var t=!0,i=2;i<e;i++)2!==(e/=2)&&(t=e%2==0);return t},changeUser:function(){this.phoneNumber="",this.verificationCode="",this.tokenReceiveFlag=!1,__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.remove("")},getRewardRecordList:function(){var e=this;this.$http.get(this.$baseUrl+this.queryRewardTraceRequest,{params:{activityId:""}}).then(function(t){console.log("getRewardRecordList",t),t=t.data,e.rewardRecordList=t})},close:function(){this.dialogFlag=!1,this.tokenReceiveFlag=!1,this.loginToGetPrizeListFlag=!1},checkAuthorized:function(){return"undefined"===__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-accessToken")||void 0===__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-accessToken")},loginToCheckMyPrize:function(){this.checkAuthorized()?(this.dialogFlag=!0,this.loginToGetPrizeListFlag=!0):this.$router.push({name:"myPrizeList",query:{loginId:__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-loginId"),pageNo:0}})},login:function(){var e=this;return this.phoneNumber=this.phoneNumber.replace(/(^\s*)|(\s*$)/g,""),this.verificationCode=this.verificationCode.replace(/(^\s*)|(\s*$)/g,""),""===this.phoneNumber?void this.$vux.confirm.show({showCancelButton:!1,title:"手机号未填写",onConfirm:function(){}}):!1===/^[1-9]+[0-9]*]*$/.test(this.phoneNumber)?void this.$vux.confirm.show({showCancelButton:!1,title:"手机号不是数字",onConfirm:function(){}}):!1===/^[1-9]+[0-9]*]*$/.test(this.verificationCode)?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码不是数字",onConfirm:function(){}}):!1===/^\d{6}$/.test(this.verificationCode)?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码不为6位数字",onConfirm:function(){}}):""===this.verificationCode?void this.$vux.confirm.show({showCancelButton:!1,title:"验证码未填写",onConfirm:function(){}}):void this.getWechatToken({type:"sms",params:{username:this.phoneNumber,code:this.verificationCode,source:"zhinengxiaoyuan",promotionCode:"",openId:this.openId,channel:this.channel,activityId:this.activityId}}).then(function(t){e.$http.post(e.$baseUrl+e.oauthTokenRequest,{grant_type:"sms",username:e.phoneNumber,code:e.verificationCode},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic YW5kcm9pZDphZG1pbg=="},transformRequest:[function(e){var t="";for(var i in e)t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i])+"&";return t}]}).then(function(t){console.log(t),__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.set("wheel-accessToken",t.access_token),__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.set("wheel-loginId",e.phoneNumber),e.$router.push({name:"myPrizeList",query:{loginId:__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-loginId"),pageNo:0,token:t.access_token}})}).catch(function(t){e.$vux.confirm.show({showCancelButton:!1,title:t.data.error_description||t.data.message,onConfirm:function(){}})})})},getCacheData:function getCacheData(){var regex=new RegExp(/(true)|(false)/);console.log(regex.test(sessionStorage.getItem("alreadyReleasedPrize"))),regex.test(sessionStorage.getItem("alreadyReleasedPrize"))&&(this.alreadyReleasedPrize=eval(sessionStorage.getItem("alreadyReleasedPrize")),this.rewardCode=sessionStorage.getItem("rewardCode"),this.rewardStr=sessionStorage.getItem("rewardStr"),this.prizeData=JSON.parse(sessionStorage.getItem("prizeData"))),regex.test(sessionStorage.getItem("alreadyReceivedPrize"))&&(this.alreadyReceivedPrize=eval(sessionStorage.getItem("alreadyReceivedPrize"))),"number"==typeof Number(sessionStorage.getItem("dailyLimit"))&&(this.dailyLimit=sessionStorage.getItem("dailyLimit")),"object"===__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof___default()(JSON.parse(sessionStorage.getItem("prizeData")))?this.alreadyReleasedPrize=eval(sessionStorage.getItem("alreadyReleasedPrize")):(console.log(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(JSON.parse(sessionStorage.getItem("prizeData"))).length>0),this.cleanCache()),"object"===__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof___default()(JSON.parse(sessionStorage.getItem("userInfo")))&&(this.userInfo=JSON.parse(sessionStorage.getItem("userInfo")))},cleanCache:function(){this.alreadyReleasedPrize=!1,this.alreadyReceivedPrize=!1,this.dialogFlag=!1,this.phoneNumberReceiveFlag=!1,this.tokenReceiveFlag=!1,setTimeout(function(){sessionStorage.removeItem("alreadyReleasedPrize"),sessionStorage.removeItem("alreadyReceivedPrize"),sessionStorage.removeItem("rewardCode"),sessionStorage.removeItem("rewardStr"),sessionStorage.removeItem("prizeData"),sessionStorage.removeItem("actualRotate"),sessionStorage.removeItem("dailyLimit"),sessionStorage.removeItem("userInfo")},500)},getStatisticImageUrl:function(){this.statisticImageUrl=this.$baseUrl+"message-service/1.0.0/statistics.jpg?source=tongcheng&timeStamp="+Date.parse(new Date)},recordStatisticEvent:function(e){var t=document.createElement("img");t.className="statistic",t.src=this.$baseUrl+"message-service/1.0.0/statistics.jpg?source=tongcheng&timeStamp="+Date.parse(new Date)+"&eventId="+e+"&webId="+this.pageFingerPrint,t.width=0,t.height=0,document.querySelector(".wheel_realpage_container").appendChild(t)},checkUUID:function(){__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-pageFingerPrint")?this.pageFingerPrint=__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.get("wheel-pageFingerPrint"):(this.pageFingerPrint=this.$generateUUID(),__WEBPACK_IMPORTED_MODULE_5_js_cookie___default.a.set("wheel-pageFingerPrint",this.pageFingerPrint))},initJSSDK:function(){var e=this;console.log("777",location.href.split("#")[0]);var t=this.$wechat;this.$http.post(this.$baseUrl+this.getSignatureRequest,{url:location.href.split("#")[0]},{headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){var t="";for(var i in e)t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i])+"&";return t}]}).then(function(i){console.log(i),t.config({debug:!1,appId:"wx67c26ff8068af257",timestamp:i.data.timestamp,nonceStr:i.data.nonceStr,signature:i.data.signature,jsApiList:["closeWindow","chooseWXPay","onMenuShareAppMessage","onMenuShareTimeline","hideMenuItems"]}),t.error(function(e){console.log(e),alert("error")}),t.ready(function(i){console.log(i),t.checkJsApi({jsApiList:["onMenuShareAppMessage","onMenuShareTimeline"],success:function(e){}}),t.onMenuShareTimeline({title:"免费畅享全年NBA直播的机会在这里",link:e.$domainUrl+"/?routeto=shareredirect&state="+e.stateCode,imgUrl:"http://resource.zan-qian.com/share/red_packet20180727191755.png-style_108x144",success:function(){}}),t.onMenuShareAppMessage({title:"免费畅享全年NBA直播的机会在这里",desc:"千万不要错过哦",link:e.$domainUrl+"/?routeto=shareredirect&state="+e.stateCode,imgUrl:"http://resource.zan-qian.com/share/red_packet20180727191755.png-style_108x144",type:"",dataUrl:"",success:function(){}})})})},checkUserAgent:function(){var e=navigator.userAgent,t=void 0,i=e.indexOf("Android")>-1||e.indexOf("Adr")>-1,a=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),o="micromessenger"===!!e.match(/MicroMessenger/i);return i?(t="android",alert("Android")):a?(t="ios",alert("iOS")):o?(alert("wechat"),t="wechat"):(alert("web"),t="web"),this.environment=t,t},checkEnvironment:function checkEnvironment(){var environment=void 0;switch(environment=this.environmentDictionary.filter(function(item){return void 0!==eval(item.checker)})[0].name){case"ios":case"android":case"wechat":console.warn(environment),alert("environment+"+environment)}return this.environment=environment,environment}}}},Trrl:function(e,t,i){var a=i("MA3+");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i("FIqI")("0dde223e",a,!1,{})}});