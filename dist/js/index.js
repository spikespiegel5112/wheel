$(document).ready(function(){$(".container").css("height",window.innerHeight),$(".poster-wrap").css("min-height",window.innerHeight);var i=imgH=0,o=$(".temp-wrap"),n=document.createElement("canvas"),a=n.getContext("2d"),s=(window.devicePixelRatio||1)/(a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1);$(".btn").click(function(){var t=$("#tel").val(),e=/^[1][3,4,5,7,8][0-9]{9}$/;if(console.log(t),console.log(!e.test(t)),!e.test(t))return $(".prompt").text("请输入正确的手机号"),$(".prompt").css("visibility","visible"),!1;$.ajax({type:"post",url:"http://testgate.zan-qian.com/promotion-service/1.0.0/addPromotionCode/{phone_number}",data:{phone_number:t},ContentType:"application/x-www-form-urlencoded",async:!0,success:function(t){if(t.result){$(".code").text(t.code),$(".prompt").css("visibility","hidden"),$(".poster-wrap").show(),i=$(".temp-wrap").width(),imgH=$(".temp-wrap").height(),n.width=i*s,n.height=imgH*s,n.style.width=i+"px",n.style.height=imgH+"px",a.scale(s,s);var e={scale:s,canvas:n,logging:!0,width:i,height:imgH};html2canvas(o,e).then(function(t){var e=t.toDataURL("image/png");e&&($(".img-box").hide(),$(".saveImg").show(),$(".saveImg").attr("src",e))})}else $(".prompt").text("你还不是团长哦!"),$(".prompt").css("visibility","visible"),$(".poster-wrap").hide()}})})});